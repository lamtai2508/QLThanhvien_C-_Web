@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model List<QLThanhvien_Web.Models.Device>

<div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Quản Lý</h2>
            <div class="user-info">
                <div class="user-name" style="text-align: center; font-size: 25px">Chào mừng tới thư quán</div>
                @* <div class="user-avatar">N</div> *@
                @* <div class="user-name">Nguyễn Văn A</div> *@
            </div>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" onclick="window.location.href='/Member/Profile'">
                <i>👤</i> Thông tin cá nhân
            </div>
            <div class="menu-item active">
                <i>📅</i> Đặt chỗ thiết bị
            </div>
            <div class="menu-item" onclick="window.location.href='/Booking/Booking_history'">
                <i>📚</i> Lịch sử đặt chỗ
            </div>
            <div class="menu-item" onclick="window.location.href='/Violation/Violations_history'">
                <i>⚠️</i> Lịch sử vi phạm
            </div>
            <div class="menu-item" onclick="window.location.href='/ChangePassword/ChangePassword'">
                <i>🔒</i> Đổi mật khẩu
            </div>
            <div class="menu-item" onclick="window.location.href='/Login/Login'">
                <i>🔚</i> Đăng xuất
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1>Đặt Chỗ Thiết Bị</h1>
            <div class="search-bar">
                <input type="text" placeholder="Tìm kiếm thiết bị...">
                <button>🔍</button>
            </div>
        </div>

        <!-- Available Devices -->
        <div class="content-section">
            <div class="section-header">
                <h2>Thiết bị có sẵn</h2>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Mã Thiết bị</th>
                            <th>Tên thiết bị</th>
                            <th>Loại</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="deviceTableBody">
                        @foreach (var d in Model)
                        {
                            <tr>
                                <td name="device_id">@d.device_id</td>
                                <td name="device_name">@d.device_name</td>
                                <td name="device_type">@d.device_type</td>
                                <td name="status"><span class="status approved" @(d.status =="bình thường" ? "approved" : "denied" )>@d.status</span></td>
                                <td><button class="btn btn-primary">Đặt ngay</button></td>
                            </tr>
                        }
                        </tbody>
                    </div>
                </table>
                <div style="margin-top:10px;">
                    <button onclick="prevPage()" id="prevBtn">Previous</button>
                    <span id="page-info"></span>
                    <button onclick="nextPage()" id="nextBtn">Next</button>
                </div>
            </div>
            </div>

            <!-- Booking Form -->
            <div class="content-section">
                <div class="section-header">
                    <h2>Đặt chỗ thiết bị</h2>
                </div>
                <form class="booking-form">
                    <div class="form-group">
                        <label for="device">Thiết bị</label>
                        <select id="device">
                            <option value="">Chọn thiết bị</option>
                            <option value="1">Máy tính xách tay Dell XPS</option>
                            <option value="2">Máy chiếu Sony VPL-EX455</option>
                            <option value="3">iPad Pro 12.9</option>
                            <option value="5">Máy in HP LaserJet Pro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Ngày đặt</label>
                        <input type="date" id="date">
                    </div>
                    <div class="form-group">
                        <label for="start-time">Thời gian bắt đầu</label>
                        <input type="time" id="start-time">
                    </div>
                    <div class="form-group">
                        <label for="end-time">Thời gian kết thúc</label>
                        <input type="time" id="end-time">
                    </div>
                    <div class="form-group">
                        <label for="purpose">Mục đích sử dụng</label>
                        <textarea id="purpose" placeholder="Nhập mục đích sử dụng thiết bị..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="location">Địa điểm sử dụng</label>
                        <input type="text" id="location" placeholder="Nhập địa điểm sử dụng">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary">Hủy</button>
                        <button type="submit" class="btn btn-primary">Đặt chỗ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
       var devices = [
    @foreach (var d in Model)
    {
        @: {
        @: "device_id": "@d.device_id",
        @: "device_name": "@d.device_name",
        @: "device_type": "@d.device_type",
        @: "status": "@d.status"
        @: },
    }
    ];

    var currentPage = 1;
    var pageSize = 5;

    function renderDevices() {
        var start = (currentPage - 1) * pageSize;
        var end = start + pageSize;
        var pageDevices = devices.slice(start, end);

        var tableBody = document.getElementById("deviceTableBody");
        tableBody.innerHTML = "";

        pageDevices.forEach(function(device) {
            var row = `<tr>
                            <td>${device.device_id}</td>
                            <td>${device.device_name}</td>
                            <td>${device.device_type}</td>
                            <td><span class="status ${device.status == "bình thường" ? "approved" : "denied"}">${device.status}</span></td>
                            <td><button class="btn btn-primary">Đặt ngay</button></td>
                        </tr>`;
            tableBody.innerHTML += row;
        });

        document.getElementById("page-info").innerText = `Trang ${currentPage} / ${Math.ceil(devices.length / pageSize)}`;

        // Toggle visibility of buttons
        document.getElementById("prevBtn").style.display = currentPage > 1 ? 'inline-block' : 'none';
        document.getElementById("nextBtn").style.display = currentPage * pageSize < devices.length ? 'inline-block' : 'none';
    }

    function nextPage() {
        if (currentPage * pageSize < devices.length) {
            currentPage++;
            renderDevices();
        }
    }

    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            renderDevices();
        }
    }

    // Render lần đầu
    renderDevices();
    </script>
